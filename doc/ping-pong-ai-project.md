# æ©Ÿå™¨å­¸ç¿’å°ˆé¡Œ - ä¹’ä¹“çƒéŠæˆ² AI ç³»çµ±

[![Python](https://img.shields.io/badge/Python-3-yellow.svg)](https://www.python.org/)
[![PyTorch](https://img.shields.io/badge/Pytorch-1.5-orange.svg)](https://pytorch.org/)
[![GYM](https://img.shields.io/badge/GYM-0.17-turquoise.svg)](https://gym.openai.com/)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)

åŸºæ–¼ Dueling Double DQN ç®—æ³•çš„ Atari Pong éŠæˆ² AI è¨“ç·´ç³»çµ±ï¼Œä½¿ç”¨è¦–è¦ºè¼¸å…¥å¯¦ç¾è‡ªä¸»å­¸ç¿’èˆ‡æ±ºç­–ã€‚

---

## ğŸ“‹ ç›®éŒ„

- [éœ€æ±‚åˆ†æ](#-éœ€æ±‚åˆ†æ)
- [ç³»çµ±åˆ†æ](#-ç³»çµ±åˆ†æ)
- [ç³»çµ±è¨­è¨ˆ](#-ç³»çµ±è¨­è¨ˆ)
- [ç·¨ç¢¼å¯¦ç¾](#-ç·¨ç¢¼å¯¦ç¾)
- [å¾…æ¸¬è©¦èˆ‡æ¸¬è©¦](#-å¾…æ¸¬è©¦èˆ‡æ¸¬è©¦)
- [åƒè€ƒè³‡æº](#-åƒè€ƒè³‡æº)
- [ç°¡å ± Todo](#ç°¡å ±-todo)

---

## ç°¡å ± Todo

| æ—¥æœŸ | é …ç›® |
| :-- | :-- |
| 1211 | é—œæ–¼ `ping-pong-ai-project.md`ï¼š1) Dueling çš„ç›®æ¨™ Q å€¼åœ¨ `Ben_DQN.py` ä¸­ç›®æ¨™ Q å€¼æ˜¯å¤šå°‘ï¼Ÿ 2) Dueling Q å€¼è¨ˆç®—å…¬å¼ä¸­çš„ A å€¼ä»£è¡¨ reward å—ï¼Ÿåœ¨ `Ben_DQN.py` ä¸­æ¯æ¬¡çµ¦çš„ reward æ˜¯å¤šå°‘ï¼Ÿ |
| 1218 | (ç©º / å¾…è£œ) |

### 1211 â€” å›ç­”èˆ‡èªªæ˜
1) Ben_DQN.py ä¸­çš„ç›®æ¨™ Q å€¼ï¼ˆtarget Qï¼‰ï¼š
   - target Q åœ¨ç¨‹å¼ä¸­è¨ˆç®—ç‚ºï¼š
     `expected_q_value = reward + gamma * next_states_target_q_value * (1 - done)`
   - next_states_target_q_value çš„ä¾†æºï¼š
     - ä½¿ç”¨ Double DQNï¼šonline network é¸æ“‡ argmax å‹•ä½œï¼ˆ`next_states_q_values.max(1)[1]`ï¼‰ï¼Œå†ç”± target network åœ¨è©²å‹•ä½œç´¢å¼•è™•è©•ä¼° Q å€¼ï¼ˆ`next_states_target_q_values.gather(...)`ï¼‰ã€‚
   - å› æ­¤ï¼Œå½¢å¼ä¸Šç­‰åŒæ–¼ï¼š
     `target = r + Î³ * Q_target(s', argmax_a Q_online(s', a))`

2) Aï¼ˆAdvantageï¼‰æ˜¯å¦ç­‰æ–¼ rewardï¼ŸBen_DQN.py ä¸­æ¯æ¬¡ reward ç‚ºå¤šå°‘ï¼Ÿ
   - A ä¸æ˜¯ rewardã€‚A(s,a) åœ¨ Dueling network è¡¨ç¤º advantageï¼ˆå‹•ä½œç›¸å°æ–¼è©²ç‹€æ…‹çš„ç›¸å°å„ªå‹¢å€¼ï¼‰ï¼Œç”¨ä¾†å’Œç‹€æ…‹åƒ¹å€¼ V(s) åˆæˆ Q(s,a)ï¼š`Q = V + (A - mean(A))`ã€‚
   - Ben_DQN.py ä¸­çš„ reward æ˜¯ç”±ç’°å¢ƒåœ¨ `environment.step(action)` ä¸­å›å‚³ã€‚
   - ä¾æœ¬å°ˆæ¡ˆèˆ‡å…¸å‹ Atari Pong è¨­è¨ˆï¼Œç’°å¢ƒå›å‚³çš„å³æ™‚ reward å¸¸è¦‹é›†åˆç‚º {-1, 0, +1}ã€‚

---

## ğŸ¯ éœ€æ±‚åˆ†æ

### 1.1 åŠŸèƒ½æ€§éœ€æ±‚

| ID | åŠŸèƒ½æè¿° | å„ªå…ˆç´š |
|:---|:---------|:------:|
| F1 | OpenAI Gym ç’°å¢ƒåˆå§‹åŒ– | P0 |
| F2 | åœ–åƒé è™•ç†èˆ‡ç‹€æ…‹ç®¡ç† | P0 |
| F3 | AI æ±ºç­–èˆ‡å‹•ä½œåŸ·è¡Œ | P0 |
| F4 | ç¶“é©—å›æ”¾æ©Ÿåˆ¶ | P0 |
| F5 | Dueling DQN ç¶²çµ¡è¨“ç·´ | P0 |
| F6 | ç›®æ¨™ç¶²çµ¡åŒæ­¥æ›´æ–° | P1 |
| F7 | æ¨¡å‹ä¿å­˜èˆ‡åŠ è¼‰ | P1 |
| F8 | è¨“ç·´çµæœè¦–è¦ºåŒ– | P2 |

### 1.2 è¦æ ¼éœ€æ±‚

```yaml
éŠæˆ²ç’°å¢ƒ:
  ç’°å¢ƒåç¨±: PongDeterministic-v4
  åŸå§‹è¼¸å…¥: 210Ã—160Ã—3 RGB åœ–åƒ
  è™•ç†å¾Œè¼¸å…¥: 80Ã—64Ã—4 ç°åº¦åœ–åƒ (4å¹€å †ç–Š)
  å‹•ä½œç©ºé–“: 6 (Atari æ¨™æº–å‹•ä½œé›†)

AI æ¨¡å‹:
  è¼¸å…¥ç¶­åº¦: [4, 80, 64] (é€šé“Ã—é«˜Ã—å¯¬)
  è¼¸å‡ºå‹•ä½œç©ºé–“: 6
  ç¶²çµ¡é¡å‹: Dueling CNN
  æ¨ç†å»¶é²: GPU <10 ms, CPU <50 ms

è¨“ç·´é…ç½®:
  æœ€å¤§è¨˜æ†¶å®¹é‡: 50,000 transitions
  æœ€å°è¨“ç·´è¨˜æ†¶: 40,000 transitions
  æ‰¹æ¬¡å¤§å°: 64
  ç›®æ¨™ç¶²çµ¡æ›´æ–°: æ¯ episode çµæŸ
```

---

## ğŸ“Š ç³»çµ±åˆ†æ

### 2.1 ç”¨ä¾‹åœ– (Use Case)

```mermaid
graph TB
    subgraph ç³»çµ±é‚Šç•Œ
        UC1[è¨“ç·´ Dueling DQN æ¨¡å‹]
        UC2[åŸ·è¡Œ Atari Pong éŠæˆ²]
        UC3[è©•ä¼°æ¨¡å‹æ€§èƒ½]
        UC4[ä¿å­˜/åŠ è¼‰æ¨¡å‹æª¢æŸ¥é»]
        UC5[ç›£æ§è¨“ç·´æŒ‡æ¨™]
    end

    Developer[é–‹ç™¼è€…] -->|è¨“ç·´| UC1
    Developer -->|ä¿å­˜| UC4
    Developer -->|ç›£æ§| UC5

    Player[æ¸¬è©¦è€…] -->|å°æˆ°| UC2

    Researcher[ç ”ç©¶å“¡] -->|è©•ä¼°| UC3
    Researcher -->|åŠ è¼‰| UC4

    UC1 -.->|include| UC4
    UC1 -.->|include| UC5
    UC2 -.->|include| UC4
```

### 2.2 åƒæ•¸èˆ‡æå¤±å‡½æ•¸çš„å«ç¾©

#### 2.2.1 Dueling DQN åƒæ•¸å®šç¾©

**å®Œæ•´åƒæ•¸é›†åˆ**:
$$\theta = \{W_{conv1}, b_{conv1}, \gamma_{bn1}, \beta_{bn1}, ..., W_A, b_A, W_V, b_V\$$

å…¶ä¸­ Dueling æ¶æ§‹åŒ…å«ï¼š
- **å…±äº«å·ç©å±¤**: 3å±¤CNNæå–è¦–è¦ºç‰¹å¾µ
- **å‹•ä½œå„ªå‹¢æµ (Advantage Stream)**: $A(s,a)$ - è©•ä¼°å„å‹•ä½œç›¸å°å„ªå‹¢
- **ç‹€æ…‹åƒ¹å€¼æµ (Value Stream)**: $V(s)$ - è©•ä¼°ç•¶å‰ç‹€æ…‹æ•´é«”åƒ¹å€¼

| é …ç›®                 | å®šç¾©                                    | éŠæˆ²ä¸­çš„ä»£è¡¨æ„ç¾©           | æ©Ÿåˆ¶èªªæ˜ |
|----------------------|-----------------------------------------|--------------------------|---------|
| **Î¸ (æ¨¡å‹åƒæ•¸)**     | DQN ç¥ç¶“ç¶²çµ¡çš„æ‰€æœ‰æ¬Šé‡èˆ‡åç½®            | AIå¤§è…¦ä¸­æ±ºå®šå‹•ä½œçš„çŸ¥è­˜     | æ¯å€‹ç¥ç¶“å…ƒçš„é€£æ¥å¼·åº¦ï¼Œæ±ºå®šç‹€æ…‹â†’Qå€¼çš„æ˜ å°„ |
| **åˆå§‹ Î¸â‚€**         | éš¨æ©Ÿåˆå§‹åŒ–çš„å°å€¼                        | è¨“ç·´å‰AIå°éŠæˆ²ä¸€ç„¡æ‰€çŸ¥     | éš¨æ©Ÿæ¬Šé‡å°è‡´æ±ºç­–äº‚çŒœ |
| **æ›´æ–°å¾Œ Î¸*/Î¸_best** | è¨“ç·´å®Œæˆå¾Œçš„æœ€å„ªåƒæ•¸                    | ç¶“éå­¸ç¿’çš„AIå¤§è…¦           | ç¶“é1000å±€è¨“ç·´ï¼Œå·²å­¸æœƒé æ¸¬çƒçš„è»Œè·¡ |
| **âˆ‡Î¸ (æ¢¯åº¦)**       | æå¤±å‡½æ•¸ç›¸å°åƒæ•¸çš„åå°æ•¸                | AIæ”¹é€²çš„æ–¹å‘æŒ‡ç¤º           | å‘Šè¨´å„ªåŒ–å™¨æ‡‰è©²å¢åŠ é‚„æ˜¯æ¸›å°‘æŸå€‹åƒæ•¸ |

#### 2.2.1.1 ç¶²çµ¡æ¶æ§‹åœ–

```mermaid
graph LR
    I("è¼¸å…¥å±¤<br/>[4Ã—80Ã—64]<br/>4å¹€å †ç–Š<br/>ç°åº¦åœ–åƒ")

    C1("Conv1<br/>32@18Ã—14<br/>kernel=8, s=4<br/>+BatchNorm<br/>+ReLU")

    C2("Conv2<br/>64@8Ã—6<br/>kernel=4, s=2<br/>+BatchNorm<br/>+ReLU")

    C3("Conv3<br/>64@6Ã—4<br/>kernel=3, s=1<br/>+BatchNorm<br/>+ReLU")

    F("Flatten<br/>[1536]")

    A1("Advantage<br/>FC1: 1536â†’128<br/>LeakyReLU")
    A2("Advantage<br/>FC2: 128â†’6<br/>A(s,a)")

    V1("Value<br/>FC1: 1536â†’128<br/>LeakyReLU")
    V2("Value<br/>FC2: 128â†’1<br/>V(s)")

    Q("Q å€¼èšåˆ<br/>Q(s,a) = V(s) +<br/>(A(s,a) - mean(A))")

    D("å‹•ä½œé¸æ“‡<br/>argmax(Q)<br/>æˆ– Îµ-greedy")

    I --> C1 --> C2 --> C3 --> F
    F --> A1 --> A2
    F --> V1 --> V2
    A2 --> Q
    V2 --> Q
    Q --> D

    style I fill:#e3f2fd,stroke:#1976d2,stroke-width:3px,color:#000
    style C1 fill:#fff3e0,stroke:#e65100,stroke-width:2px,color:#000
    style C2 fill:#fff3e0,stroke:#e65100,stroke-width:2px,color:#000
    style C3 fill:#fff3e0,stroke:#e65100,stroke-width:2px,color:#000
    style F fill:#f3e5f5,stroke:#4a148c,stroke-width:2px,color:#000
    style A1 fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px,color:#000
    style A2 fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px,color:#000
    style V1 fill:#fff9c4,stroke:#f57f17,stroke-width:2px,color:#000
    style V2 fill:#fff9c4,stroke:#f57f17,stroke-width:2px,color:#000
    style Q fill:#c8e6c9,stroke:#388e3c,stroke-width:3px,color:#000
    style D fill:#f8bbd0,stroke:#c2185b,stroke-width:3px,color:#000
```

**Dueling Q å€¼è¨ˆç®—**:
$$Q(s,a) = V(s) + \left(A(s,a) - \frac{1}{|A|} \sum_{a'} A(s,a')\right)$$

#### 2.2.1.2 CNN ç¶²çµ¡åƒæ•¸è¡¨

| å±¤ç´š | é¡å‹ | è¼¸å…¥ç¶­åº¦ | è¼¸å‡ºç¶­åº¦ | æ ¸å¤§å° | æ­¥é•· | åƒæ•¸é‡ |
|:-----|:-----|:---------|:---------|:-------|:-----|:-------:|
| Conv1 | Conv2d | 4Ã—80Ã—64 | 32Ã—18Ã—14 | 8Ã—8 | 4 | 8,224 |
| BN1 | BatchNorm2d | 32Ã—18Ã—14 | 32Ã—18Ã—14 | - | - | 64 |
| Conv2 | Conv2d | 32Ã—18Ã—14 | 64Ã—8Ã—6 | 4Ã—4 | 2 | 32,832 |
| BN2 | BatchNorm2d | 64Ã—8Ã—6 | 64Ã—8Ã—6 | - | - | 128 |
| Conv3 | Conv2d | 64Ã—8Ã—6 | 64Ã—6Ã—4 | 3Ã—3 | 1 | 36,928 |
| BN3 | BatchNorm2d | 64Ã—6Ã—4 | 64Ã—6Ã—4 | - | - | 128 |

**ç¸½åƒæ•¸é‡**: ~472,679

#### 2.2.1.3 æå¤±å‡½æ•¸èˆ‡æ ¸å¿ƒæ©Ÿåˆ¶

**æ ¸å¿ƒæå¤±å‡½æ•¸**:
$$L(\theta) = \mathbb{E}\left[(r + \gamma \max_{a'} Q_{\theta^-}(s', a') - Q_\theta(s, a))^2\right]$$

| æ©Ÿåˆ¶ | ä½œç”¨ |
|:---|:---|
| **Double DQN** | ç”¨ç•¶å‰ç¶²çµ¡é¸æ“‡å‹•ä½œ, ç”¨ç›®æ¨™ç¶²çµ¡è©•ä¼°åƒ¹å€¼ï¼Œé¿å…éåº¦æ¨‚è§€ |
| **Dueling Network** | åˆ†é›¢ç‹€æ…‹åƒ¹å€¼èˆ‡å‹•ä½œå„ªå‹¢ä¼°è¨ˆï¼Œæå‡å­¸ç¿’æ•ˆç‡ |
| **ç¶“é©—å›æ”¾** | æ‰“ç ´æ™‚é–“ç›¸é—œæ€§, é«˜æ•ˆåˆ©ç”¨æ•¸æ“š |

---

## ğŸ—ï¸ ç³»çµ±è¨­è¨ˆ

### 3.1 ç³»çµ±æ¨¡çµ„åˆ†æ”¯åœ–

```mermaid
graph TB
    A["ğŸ® ä¹’ä¹“çƒéŠæˆ² AI ç³»çµ±<br/>(é ‚å±¤)"]
    
    A --> B["ğŸ® éŠæˆ²å¼•æ“æ¨¡çµ„"]
    A --> C["ğŸ¤– AIæ±ºç­–æ¨¡çµ„"]
    A --> D["ğŸ“š è¨“ç·´æ¨¡çµ„"]
    A --> E["ğŸ’¾ æ•¸æ“šç®¡ç†æ¨¡çµ„"]
    A --> F["ğŸ¨ è¦–è¦ºåŒ–æ¨¡çµ„"]
    
    B --> B1["âš™ï¸ ç‰©ç†å¼•æ“"]
    B --> B2["ğŸ’¥ ç¢°æ’åµæ¸¬"]
    B --> B3["ğŸ“Š ç‹€æ…‹ç®¡ç†"]
    
    C --> C1["ğŸ§  DQNæ¨¡å‹"]
    C --> C2["ğŸ”€ Îµ-greedyé¸æ“‡"]
    
    D --> D1["ğŸ”„ RLè¨“ç·´è¿´åœˆ"]
    D --> D2["ğŸ çå‹µè¨ˆç®—"]
    D --> D3["ğŸ” ç¶“é©—å›æ”¾"]
```

---

## ğŸ“š åƒè€ƒè³‡æº

### è«–æ–‡èˆ‡æ–‡ç»

1. **Double DQN**: Van Hasselt, et al. (2016)
2. **Dueling DQN**: Wang, et al. (2016)
3. **DQN**: Mnih, et al. (2015)

---

**æœ€å¾Œæ›´æ–°**: 2026å¹´1æœˆ
**ç‰ˆæœ¬**: 1.3 (æ·±åº¦æ•´åˆèˆ‡è¡çªä¿®å¾©)